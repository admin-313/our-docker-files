global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'instance']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'telegram-notifications'
  routes:
  - match:
      severity: warning
    receiver: 'telegram-warning'
  - match:
      severity: error
    receiver: 'telegram-error'
  - match:
      severity: critical
    receiver: 'telegram-critical'


receivers:
- name: 'telegram-warning'
  telegram_configs:
  - api_url: "https://api.telegram.org/bot{{ env 'TELEGRAM_BOT_TOKEN'}}/sendMessage"
    chat_id: "{{ env 'TELEGRAM_CHAT_ID'}}"
    message: '‚ö†Ô∏è Warning: High ICMP Loss Detected\n{{ range .Alerts }}\n{{ .Annotations.summary }}\n{{ .Annotations.description }}\n{{ end }}'
    parse_mode: 'HTML'
    send_resolved: true

- name: 'telegram-error'
  telegram_configs:
  - api_url: "https://api.telegram.org/bot{{ env 'TELEGRAM_BOT_TOKEN'}}/sendMessage"
    chat_id: "{{ env 'TELEGRAM_CHAT_ID'}}"
    message: 'üõë Error: Very High ICMP Loss Detected\n{{ range .Alerts }}\n{{ .Annotations.summary }}\n{{ .Annotations.description }}\n{{ end }}'
    parse_mode: 'HTML'
    send_resolved: true

- name: 'telegram-critical'
  telegram_configs:
  - api_url: "https://api.telegram.org/bot{{ env 'TELEGRAM_BOT_TOKEN'}}/sendMessage"
    chat_id: "{{ env 'TELEGRAM_CHAT_ID'}}"
    message: 'üö® Critical: Complete ICMP Loss Detected\n{{ range .Alerts }}\n{{ .Annotations.summary }}\n{{ .Annotations.description }}\n{{ end }}'
    parse_mode: 'HTML'
    send_resolved: true

inhibit_rules:
- source_match:
    severity: 'critical'
  target_match:
    severity: 'error'
  equal: ['alertname']
- source_match:
    severity: 'error'
  target_match:
    severity: 'warning'
  equal: ['alertname']